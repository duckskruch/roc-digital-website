# Отладка чата - Инструкция

## Проблема
После деплоя чат показывает ошибку: "Извините, произошла ошибка. Попробуйте еще раз или свяжитесь с нами напрямую."

## Возможные причины и решения

### 1. Отсутствует файл .env.local
**Проблема:** Переменные окружения не настроены
**Решение:** Создайте файл `.env.local` в корне проекта:

```bash
# OpenRouter API Key
OPENROUTER_API_KEY=ваш_ключ_здесь

# Site URL for OpenRouter referrer  
NEXT_PUBLIC_SITE_URL=https://ваш-домен.com

# Telegram Bot Configuration (если нужно)
TELEGRAM_BOT_TOKEN=ваш_токен_бота_здесь
TELEGRAM_ACCOUNT_ID=ваш_account_id_здесь
```

### 2. Неверный API ключ OpenRouter
**Проверка:** Откройте `/api/test-openrouter` в браузере
**Решение:** 
- Проверьте правильность API ключа в OpenRouter
- Убедитесь, что у ключа есть доступ к модели `google/gemini-2.0-flash-001`
- Проверьте баланс аккаунта OpenRouter

### 3. Проблемы с доменом
**Проблема:** OpenRouter блокирует запросы с неправильного домена
**Решение:** 
- Установите правильный `NEXT_PUBLIC_SITE_URL` в `.env.local`
- Убедитесь, что домен добавлен в настройки OpenRouter

### 4. Проблемы с моделью
**Проблема:** Модель недоступна или изменилась
**Решение:** 
- Проверьте доступность модели `google/gemini-2.0-flash-001`
- Попробуйте другую модель, например `anthropic/claude-3.5-sonnet`

## Тестирование

### Локальное тестирование
1. Создайте `.env.local` с правильными переменными
2. Запустите `npm run dev`
3. Откройте `/api/test-openrouter` для проверки API
4. Протестируйте чат на странице

### Продакшн тестирование
1. Добавьте переменные окружения в настройки хостинга
2. Пересоберите проект: `npm run build`
3. Проверьте логи сервера на наличие ошибок
4. Протестируйте `/api/test-openrouter`

## Логирование

Добавлено подробное логирование в:
- `/api/chat/route.ts` - логи запросов к OpenRouter
- `/api/test-openrouter/route.ts` - тестовый эндпоинт
- `FAQWithChat.tsx` - улучшенная обработка ошибок

## Быстрая диагностика

1. **Проверьте переменные окружения:**
   ```bash
   echo $OPENROUTER_API_KEY
   ```

2. **Проверьте API ключ:**
   Откройте `https://ваш-домен.com/api/test-openrouter`

3. **Проверьте логи сервера:**
   Посмотрите в консоль браузера и логи сервера

4. **Проверьте сетевые запросы:**
   Откройте DevTools → Network и посмотрите на запросы к `/api/chat`


